(()=>{"use strict";function e(e){e.disabled=!1}function t(e){e.disabled=!0}function o(e,t){e.value=t}function r(e){e.querySelector(".overlay__form-button").disabled=!0;for(var t=e.querySelectorAll(".overlay__form-input"),o=0;o<t.length;o++)t[o].classList.remove("overlay__form-input_error");!function(e){console.log(e);for(var t=e.querySelectorAll(".overlay__form-error"),o=0;o<t.length;o++)t[o].textContent="";var r=e.querySelectorAll(".overlay__form-input");if(r.length>0)for(var n=0;n<r.length;n++)r[n].value=""}(e)}function n(){document.querySelector(".overlay_opened").classList.remove("overlay_opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&n()}function l(e){e.classList.add("overlay_opened"),document.addEventListener("keydown",c)}document.querySelectorAll(".overlay").forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&n()}))}));var a=document.querySelector(".overlay_type_picture");function u(e){e.classList.add("card__heart_selected")}var i,s=document.querySelector(".overlay__image-popup-photo"),d=document.querySelector(".overlay__image-popup-tilte");function f(e){s.setAttribute("src",e.currentTarget.src),s.setAttribute("alt",e.currentTarget.alt),d.textContent=e.currentTarget.alt,l(a)}function _(e,t,o,r,n,c){console.log("createCard cardId =",n);var l=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),a=l.querySelector(".card__image");a.setAttribute("src",t),a.setAttribute("alt",e),l.querySelector(".card__title").textContent=e;for(var i=l.querySelector(".card__heart"),s=l.querySelector(".card__heart-counter"),d=0;d<o.length;d++)console.log(o[d]._id),console.log(c),0===o[d]._id.localeCompare(c)&&(console.log("TEST"),console.log("likeButton =",i),u(l.querySelector(".card__heart")));if(s.textContent=o.length,i.addEventListener("click",(function(e){console.log("new test =",function(e,t,o,r){return e.currentTarget.classList.contains("card__heart_selected")?(function(e){return console.log("removeLike:",e),fetch("https://nomoreparties.co/v1/plus-cohort-6/cards/likes/"+e,{method:"DELETE",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка",e)})).catch((function(e){console.log(e)}))}(t).then((function(e){console.log("test =",e),o=e.likes.length,r.textContent=o,console.log("likes =",o)})),function(e){e.classList.remove("card__heart_selected")}(e.currentTarget),o):(function(e){return console.log("giveLike:",e),fetch("https://nomoreparties.co/v1/plus-cohort-6/cards/likes/"+e,{method:"PUT",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка",e)}))}(t).then((function(e){console.log("test =",e),o=e.likes.length,r.textContent=o,console.log("likes =",o)})),u(e.currentTarget),o)}(e,n,o.length,s))})),r){console.log(l.querySelector(".card__delete-button"));var _=l.querySelector(".card__delete-button");_.addEventListener("click",(function(e){!function(e,t){console.log("TEST ID =",t),e.currentTarget.closest(".card").remove(),function(e){return console.log("deleteCard:",e),fetch("https://nomoreparties.co/v1/plus-cohort-6/cards/"+e,{method:"DELETE",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка",e)}))}(t).then((function(e){console.log("testDeleting response =",e)})),console.log(e)}(e,n)})),_.setAttribute("style","display: block")}return l.querySelector(".card__image").addEventListener("click",f),l}var v=document.querySelector(".overlay_type_profile"),m=document.querySelector(".overlay_type_card-add"),y=document.querySelector(".overlay_type_picture"),p=document.querySelector(".overlay_type_avatar-edit"),h=document.querySelector(".profile__avatar"),g=document.querySelector(".profile__intro-title"),S=document.querySelector(".profile__intro-subtitle"),q=document.querySelector(".elements"),k=document.querySelector("#overlay__form-input_line-one"),b=document.querySelector("#overlay__form-input_line-two"),E=v.querySelector("#close_profile_button"),L=m.querySelector("#close_card-add_button"),C=y.querySelector("#close_picture_button"),T=p.querySelector("#close_avatar-edit_button");Promise.all([fetch("https://nomoreparties.co/v1/plus-cohort-6/cards",{method:"GET",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка")})),fetch("https://nomoreparties.co/v1/plus-cohort-6/users/me",{method:"GET",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка")}))]).then((function(e){i=e[1]._id;for(var t=0;t<e[0].length;t++){var o=!1;i===e[0][t].owner._id&&(o=!0);var r=_(e[0][t].name,e[0][t].link,e[0][t].likes,o,e[0][t]._id,i);q.prepend(r)}console.log("cardsData =",e[0]),g.textContent=e[1].name,S.textContent=e[1].about,h.setAttribute("src",e[1].avatar)}));var A=document.querySelector("#overlay__form-new-card-name-input"),j=document.querySelector("#overlay__form-new-card-url-input"),x=document.querySelector("#overlay__form-new-profile-image-input");E.addEventListener("click",(function(){n()})),L.addEventListener("click",(function(){n()})),C.addEventListener("click",(function(){n()})),T.addEventListener("click",(function(){n()}));var P=document.querySelector("#edit_form"),w=document.querySelector("#add_form"),z=document.querySelector("#avatar_edit_form");P.addEventListener("submit",(function(e){e.preventDefault(),g.textContent=k.value,S.textContent=b.value;var t,r,c=e.submitter;o(c,"Сохранение..."),(t=g.textContent,r=S.textContent,console.log("changeProfile"),console.log("newName =",t),console.log("newAbout =",r),fetch("https://nomoreparties.co/v1/plus-cohort-6/users/me",{method:"PATCH",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161","Content-Type":"application/json"},body:JSON.stringify({name:t,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка")}))).then((function(e){n(),o(c,"Сохранить")}))}),!0),w.addEventListener("submit",(function(e){var t,r,c;e.preventDefault(),o(e.submitter,"Создание..."),(r=A.value,c=j.value,console.log("addCard"),console.log("name =",r),console.log("link =",c),fetch("https://nomoreparties.co/v1/plus-cohort-6/cards",{method:"POST",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161","Content-Type":"application/json"},body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка")}))).then((function(e){t=e._id,console.log("added card id =",e._id),console.log("TEST =",t);var o=_(A.value,j.value,0,!0,t);q.prepend(o),n()}))}),!0),z.addEventListener("submit",(function(e){e.preventDefault();var t,r=e.submitter;o(r,"Сохранение..."),(t=x.value,console.log("updateAvatar"),fetch("https://nomoreparties.co/v1/plus-cohort-6/users/me/avatar",{method:"PATCH",headers:{authorization:"230ea98f-ed00-4030-a408-2ee71d4ed161","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():(console.log("res =",e),Promise.reject("Ошибка"))}))).then((function(e){n(),o(r,"Сохранить")}))}),!0);var D=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__add-button"),O=document.querySelector(".profile__avatar-overlay");D.addEventListener("click",(function(){!function(e){r(e),k.value=g.textContent,b.value=S.textContent,l(e)}(v)})),N.addEventListener("click",(function(){!function(e){r(e),l(e)}(m)})),O.addEventListener("click",(function(){!function(e){r(e),l(e)}(p)})),function(o,r,n,c,l){for(var a=Array.from(document.querySelectorAll(o)),u=function(o){a[o].addEventListener("input",(function(r){!function(o,r,n,c,l){for(var a=Array.from(o.querySelectorAll(".overlay__form-input")),u=0;u<a.length;u++){var i=a[u];i.inputSubtitleErrorClass=".overlay__form-error";var s=i.checkValidity(),d=i.closest(".overlay__form").querySelector(".overlay__form-button");if(!s){t(d);break}e(d)}}(a[o])}));for(var n=Array.from(a[o].querySelectorAll(r)),l=function(e){n[e].addEventListener("input",(function(){var t,o;t=n[e],o=t.checkValidity(),t.closest(".input-group").querySelector(t.inputSubtitleErrorClass).textContent=t.validationMessage,o?function(e,t){e.classList.remove("overlay__form-input_error")}(t):function(e,t){e.classList.add("overlay__form-input_error")}(t)})),n[e].inputSubtitleErrorClass=c},u=0;u<n.length;u++)l(u)},i=0;i<a.length;i++)u(i)}(".overlay__form",".overlay__form-input",0,".overlay__form-error")})();